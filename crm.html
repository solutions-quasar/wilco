<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wilco Plumbing CRM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="crm.css">
    <link rel="stylesheet" href="calendar.css">
    <link rel="stylesheet" href="ai_chat.css">

    <!-- Favicon & Social -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.png">
    <meta property="og:title" content="Wilco Plumbing CRM">
    <meta property="og:description" content="Professional Plumbing Management System">
    <meta property="og:image" content="assets/social_share.png">
    <meta property="og:url" content="https://solutions-quasar.github.io/wilco/">
</head>

<body>



    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-card">
            <h2>Wilco CRM Login</h2>
            <form id="login-form">
                <div class="input-group">
                    <label>Email Address</label>
                    <input type="email" id="email" placeholder="admin@wilcoplumbing.com">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <div class="password-wrapper" style="position: relative;">
                        <input type="password" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="padding-right: 40px;">
                        <span id="toggle-password"
                            style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #94a3b8;">
                            <!-- Eye Icon (SVG) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </span>
                    </div>
                </div>

                <div class="login-options">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="remember-email"> Remember Email
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="stay-signed-in" checked> Stay Logged In
                    </label>
                </div>

                <button type="submit" class="btn-crm">Login to Dashboard</button>

                <div
                    style="margin-top: 1.5rem; display: flex; flex-direction: column; gap: 0.5rem; align-items: center;">
                    <a href="#" onclick="crm.openForgotModal()"
                        style="color: var(--warning); text-decoration: none; font-size: 0.85rem;">Forgot Password?</a>
                    <button type="button" onclick="crm.sendMagicLink()"
                        style="background: transparent; border: 1px solid var(--border); color: var(--text-muted); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.85rem; width: 100%;">
                        âœ¨ Login via Magic Link
                    </button>
                </div>
            </form>
            <p style="margin-top: 1rem; font-size: 0.8rem; color: #94a3b8; display: none;">
                (Mock Mode: Just click Login!)
            </p>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgot-overlay" class="modal-overlay">
        <div class="modal-card" style="max-width: 400px; padding: 2rem;">
            <div class="modal-header">
                <h3>Reset Password</h3>
                <button class="close-btn"
                    onclick="document.getElementById('forgot-overlay').classList.remove('open')">Ã—</button>
            </div>
            <div style="padding: 1.5rem 0;">
                <p style="color: var(--text-muted); margin-bottom: 1rem;">Enter your email to receive a password reset
                    link.</p>
                <input type="email" id="reset-email" placeholder="admin@wilcoplumbing.com">
            </div>
            <button class="btn-crm" style="width: 100%;" onclick="crm.resetPassword()">Send Reset Link</button>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay" onclick="crm.toggleSidebar()"></div>

    <!-- Mobile Header -->
    <div class="mobile-header-crm">
        <h3 style="font-weight: 800; color: #fcd34d;">WILCO<span style="color:#fff;">CRM</span></h3>
        <button class="menu-toggle-btn" onclick="crm.toggleSidebar()">â˜°</button>
    </div>

    <!-- Onboarding Modal -->
    <div id="onboarding-overlay" class="modal-overlay">
        <div class="modal-card" id="onboarding-card" style="max-width: 500px; text-align: center; padding: 2rem;">
            <div id="onboarding-content">
                <!-- Dynamic Content Here -->
            </div>
            <div class="modal-footer" style="justify-content: center; margin-top: 1.5rem;">
                <button class="btn-crm" id="btn-onboarding-next" onclick="crm.nextOnboardingStep()">Next</button>
            </div>
        </div>
    </div>

    <div id="dashboard-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div style="text-align: center;">
                    <h2 style="font-size: 1.5rem; letter-spacing: -0.5px;">WILCO<span
                            style="color:var(--text-main);">CRM</span></h2>
                    <span
                        style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); display: block; margin-top: 4px;">Powered
                        by AI âœ¨</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <button class="nav-btn active" onclick="crm.switchView('dashboard')">
                    <i class='bx bxs-dashboard nav-icon'></i> Dashboard
                </button>
                <button class="nav-btn" onclick="crm.switchView('daily')">
                    <i class='bx bx-calendar nav-icon'></i> Calendar
                </button>
                <button class="nav-btn" onclick="crm.switchView('invoices')">
                    <i class='bx bx-file nav-icon'></i> Invoices & Quotes
                </button>
                <button class="nav-btn" onclick="crm.switchView('products')">
                    <i class='bx bx-box nav-icon'></i> Products & Services
                </button>
                <button class="nav-btn" onclick="crm.switchView('clients')">
                    <i class='bx bx-user nav-icon'></i> Clients
                </button>
                <button class="nav-btn" onclick="crm.switchView('team')">
                    <i class='bx bx-hard-hat nav-icon'></i> Team
                </button>


                <div style="flex: 1;"></div> <!-- Spacer -->

                <button class="nav-btn" onclick="crm.switchView('account')">
                    <i class='bx bx-slider-alt nav-icon'></i> My Account
                </button>
            </nav>

            <div class="sidebar-footer">
                <div style="display: flex; justify-content: center; margin-bottom: 1rem;">
                    <button id="theme-toggle" class="btn-icon" onclick="crm.toggleTheme()" title="Toggle Theme"
                        style="background: var(--bg-main); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <i class='bx bx-moon'></i>
                    </button>
                </div>
                <div class="user-info" style="display: flex; align-items: center; gap: 0.75rem;">
                    <div class="avatar" style="width: 32px; height: 32px; font-size: 0.8rem;">LW</div>
                    <div class="user-details" style="overflow: hidden;">
                        <span id="user-name" style="display: block; font-weight: 600;">Lukas Wilson</span>
                        <span id="user-email"
                            style="display: block; opacity: 0.7; font-size: 0.7rem;">admin@wilco.com</span>
                    </div>
                </div>
                <div style="display:flex; flex-direction:column; gap:0.5rem; width:100%; margin-top: 0.75rem;">
                    <button id="logout-btn" class="btn-logout" style="font-size: 0.8rem; padding: 0.4rem;"><i
                            class='bx bx-log-out'></i> Logout</button>
                    <!-- Seed Button hidden but accessible -->
                    <div style="text-align: center; margin-top: 0.5rem; opacity: 0.5;">
                        <a href="https://solutionsquasar.ca" target="_blank"
                            style="font-size: 8px; color: var(--text-main); text-decoration: none;">Built by Solutions
                            Quasar Inc.</a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content-area">

            <!-- VIEW: Main Dashboard -->
            <div id="view-dashboard" class="view-section active">
                <header class="view-header">
                    <div>
                        <h2 style="margin-bottom: 0.25rem;">Welcome back</h2>
                        <p style="color: var(--text-muted); font-size: 0.9rem;">Here's what's happening today.</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn-crm small" onclick="crm.openModal('lead')">+ New Lead</button>
                    </div>
                </header>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Customers</h3>
                        <div class="value" id="stats-customers">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Revenue This Week</h3>
                        <div class="value" id="stats-revenue-week">$0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Active Jobs</h3>
                        <div class="value" id="stats-active">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Jobs Completed</h3>
                        <div class="value" id="stats-completed">0</div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                    <!-- Bar Chart Card -->
                    <div class="stat-card" style="height: 350px; display: flex; flex-direction: column;">
                        <h3>Revenue & Jobs Trend</h3>
                        <div id="chart-revenue"
                            style="flex: 1; display: flex; align-items: flex-end; justify-content: space-around; padding-top: 1rem; gap: 0.5rem;">
                            <!-- Bars injected via JS -->
                            <div style="text-align: center; color: var(--text-muted);">Loading charts...</div>
                        </div>
                    </div>

                    <!-- Donut Chart Card -->
                    <div class="stat-card" style="height: 350px; display: flex; flex-direction: column;">
                        <h3>Job Status</h3>
                        <div id="chart-status"
                            style="flex: 1; display: flex; align-items: center; justify-content: center; position: relative;">
                            <!-- CSS Conic Gradient Donut injected via JS -->
                        </div>
                    </div>
                </div>

                <!-- Recent Activity / High Priority -->
                <div class="stat-card">
                    <h3>Recent Jobs</h3>
                    <div class="data-table-container" style="border: none; min-height: auto;">
                        <table style="margin-top: 0.5rem;">
                            <thead>
                                <tr>
                                    <th>Job Title</th>
                                    <th>Status</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody id="dashboard-recent-body">
                                <!-- Injected via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW: Calendar -->
            <div id="view-daily" class="view-section">
                <header class="view-header">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <h2 id="calendar-title" style="margin: 0; min-width: 200px;">September 2025</h2>
                        <div class="date-controls">
                            <button class="btn-nav" onclick="crm.changeMonth(-1)"><i
                                    class='bx bx-chevron-left'></i></button>
                            <button class="btn-nav" onclick="crm.changeMonth(1)"><i
                                    class='bx bx-chevron-right'></i></button>
                            <button class="btn-secondary small" onclick="crm.goToToday()">Today</button>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="btn-crm small" onclick="crm.openModal('task')">+ New Event</button>
                        <button class="btn-secondary small" onclick="crm.openModal('blocker')">Block Time</button>
                    </div>
                </header>

                <!-- Calendar Grid -->
                <div class="calendar-wrapper">
                    <div class="calendar-days-header">
                        <div>Sun</div>
                        <div>Mon</div>
                        <div>Tue</div>
                        <div>Wed</div>
                        <div>Thu</div>
                        <div>Fri</div>
                        <div>Sat</div>
                    </div>
                    <div id="calendar-grid" class="calendar-grid">
                        <!-- JS Injected Days -->
                    </div>
                </div>
            </div>

            <!-- VIEW: Invoices -->
            <div id="view-invoices" class="view-section">
                <header class="view-header">
                    <h2>Invoices & Quotes</h2>
                    <button class="btn-crm small" onclick="crm.openModal('invoice')">+ Create Invoice</button>
                </header>

                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Client</th>
                                <th>Date Issued</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="invoices-table-body">
                            <!-- Rows injected via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- VIEW: Products -->
            <div id="view-products" class="view-section">
                <header class="view-header">
                    <h2>Products & Services</h2>
                    <button class="btn-crm small" onclick="crm.openModal('product')">+ New Product</button>
                </header>

                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="products-table-body">
                            <!-- Rows injected via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- VIEW: Clients -->
            <div id="view-clients" class="view-section">
                <header class="view-header">
                    <h2>Clients</h2>
                    <div class="view-controls">
                        <button class="btn-secondary small" onclick="crm.setClientView('list')"
                            title="List View">â‰¡</button>
                        <button class="btn-secondary small" onclick="crm.setClientView('grid')"
                            title="Grid View">âŠž</button>
                        <button class="btn-crm small" onclick="crm.openModal('client')">+ New Client</button>
                    </div>
                </header>

                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="clients-table-body">
                            <!-- Rows injected via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- VIEW: Team -->
            <div id="view-team" class="view-section">
                <header class="view-header">
                    <h2>Team Management</h2>
                    <button class="btn-crm small" onclick="crm.openModal('team')">+ Add Member</button>
                </header>

                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="team-table-body">
                            <!-- Rows injected via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- VIEW: My Account -->
            <div id="view-account" class="view-section">
                <header class="view-header">
                    <h2>My Account</h2>
                </header>

                <div class="dashboard-grid">
                    <!-- Profile Card -->
                    <div class="stats-card">
                        <h3>Profile</h3>
                        <div style="display:flex; align-items:center; gap:1rem; margin-top:1rem;">
                            <div
                                style="width:60px; height:60px; background:var(--accent); color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.5rem;">
                                LW</div>
                            <div>
                                <h4 style="margin:0;">Lukas Wilson</h4>
                                <p style="margin:0; opacity:0.7;">Owner & Admin</p>
                            </div>
                        </div>
                    </div>

                    <!-- Knowledge Base Card -->
                    <div class="stats-card" style="grid-column: span 2;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <h3>Knowledge Base (AI Brain) ðŸ§ </h3>
                            <button class="btn-crm small" onclick="crm.openModal('knowledge')">+ Add Article</button>
                        </div>
                        <p style="font-size:0.9rem; opacity:0.7; margin:0.5rem 0;">Add manuals, warranties, and
                            procedures here. The AI will search this to answer questions.</p>

                        <div class="data-table-container" style="max-height: 300px; overflow-y: auto;">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Content Snippet</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="knowledge-table-body">
                                    <!-- Knowledge Injected Here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>



        </main>
    </div>

    <!-- Floating AI Chat -->
    <button class="ai-fab" onclick="crm.toggleChat()" title="Ask AI Agent">
        <i class='bx bx-bot'></i>
    </button>

    <div id="ai-chat-window" class="ai-chat-window">
        <div class="chat-header">
            <h3 style="margin:0; font-size:1.1rem;">Wilco AI Assistant ðŸ¤–</h3>
            <button class="close-btn" onclick="crm.toggleChat()">Ã—</button>
        </div>
        <div id="chat-messages" class="chat-messages">
            <div class="message system">
                <p>Hello! I can help you with Quotes, Scheduling, and searching the Knowledge Base. How can I help?</p>
            </div>
        </div>
        <div id="audio-preview-container"
            style="display:none; padding: 0.5rem; background: var(--bg-card); border-top: 1px solid var(--border); align-items: center; gap: 0.5rem;">
            <audio id="audio-player" controls style="flex:1; height: 30px;"></audio>
            <button class="btn-icon" onclick="crm.discardAudio()" title="Discard" style="color:var(--danger);">
                <i class='bx bx-trash'></i>
            </button>
            <button class="btn-icon" onclick="crm.sendAudio()" title="Send Audio" style="color:var(--success);">
                <i class='bx bx-send'></i>
            </button>
        </div>
        <div class="chat-input-area">
            <input type="text" id="message-input" placeholder="Hold Mic to speak..." autocomplete="off"
                onkeypress="if(event.key === 'Enter') { crm.sendMessage(this.value); this.value = ''; }">
            <button class="btn-icon" id="mic-btn" style="color:var(--text-muted);" onclick="crm.toggleRecording()"
                title="Click to Record / Click to Stop">
                <i id="mic-icon" class='bx bx-microphone'></i>
            </button>
            <button class="btn-icon"
                onclick="const el = document.getElementById('message-input'); crm.sendMessage(el.value); el.value='';">
                <i class='bx bx-send'></i>
            </button>
        </div>
    </div>

    <!-- Generic Modal Overlay -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-card">
            <header class="modal-header">
                <h3 id="modal-title">Create Item</h3>
                <button class="close-btn" onclick="crm.closeModal()">Ã—</button>
            </header>
            <form id="modal-form">
                <input type="hidden" id="modal-id"> <!-- Stores ID for edits -->
                <input type="hidden" id="modal-type"> <!-- Stores Type (lead, task, invoice) -->

                <div id="modal-fields">
                    <!-- Dynamic fields injected here based on type -->
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="crm.closeModal()">Cancel</button>
                    <button type="button" class="btn-crm" onclick="crm.saveModalData()">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"
        crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"
        crossorigin="anonymous"></script>
    <script src="firebase_config.js"></script>
    <script src="crm.js"></script>
</body>

</html>