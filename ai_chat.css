/* Floating Action Button */
.ai-fab {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), #2563eb);
    color: white;
    box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
    border: none;
    font-size: 2rem;
    cursor: pointer;
    z-index: 1000;
    transition: transform 0.2s, box-shadow 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.ai-fab:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(37, 99, 235, 0.5);
}

/* Chat Window */
.ai-chat-window {
    position: fixed;
    bottom: 7rem;
    right: 2rem;
    width: 380px;
    height: 600px;
    max-height: 80vh;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 16px;
    box-shadow: var(--shadow-lg);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transform-origin: bottom right;
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.3s;
    opacity: 0;
    pointer-events: none;
    transform: scale(0.9);
}

.ai-chat-window.open {
    opacity: 1;
    pointer-events: all;
    transform: scale(1);
}

.chat-header {
    background: var(--bg-main);
    padding: 1rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Reuse existing chat styles but scoped if needed */
.ai-chat-window .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    background: var(--bg-card);
}

.ai-chat-window .chat-input-area {
    padding: 1rem;
    border-top: 1px solid var(--border);
    background: var(--bg-main);
    gap: 0.5rem;
}

/* Chat Message Styles */
.message {
    padding: 0.75rem 1rem;
    border-radius: 12px;
    font-size: 0.9rem;
    line-height: 1.4;
    max-width: 85%;
    word-wrap: break-word;
}

.message.other {
    background: var(--bg-main);
    color: var(--text-main);
    align-self: flex-start;
    border-bottom-left-radius: 2px;
}

.message.self {
    background: var(--accent);
    color: white;
    align-self: flex-end;
    border-bottom-right-radius: 2px;
}

.message.system {
    align-self: center;
    background: rgba(var(--accent-rgb), 0.1);
    color: var(--text-muted);
    font-size: 0.8rem;
    text-align: center;
    max-width: 90%;
}

.sender-name {
    display: block;
    font-size: 0.7rem;
    opacity: 0.7;
    margin-bottom: 2px;
}

/* Microphone Recording State */
.recording-pulse {
    animation: pulse-red 1.5s infinite;
    background-color: rgba(239, 68, 68, 0.1);
    border-radius: 50%;
    color: var(--danger) !important;
}

@keyframes pulse-red {
    0% {
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
    }

    70% {
        box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
    }

    100% {
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
    }
}

/* Mobile Responsive Styles */
@media (max-width: 768px) {
    .ai-chat-window {
        bottom: 0;
        right: 0;
        width: 100%;
        height: 100%;
        max-height: 100vh;
        border-radius: 0;
        border: none;
    }

    .ai-chat-window.open {
        transform: none; /* simple fade in */
    }

    /* Larger controls for touch */
    .ai-chat-window .chat-input-area input {
        height: 50px;
        font-size: 16px; /* Prevents iOS zoom */
    }

    .ai-chat-window .chat-input-area button {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
    }

    .chat-header {
        padding: 1.5rem 1rem; /* More header space */
    }

    .chat-header h3 {
        font-size: 1.3rem !important;
    }
    
    .ai-fab {
        /* Move fab out of the way or hide when chart is open if needed. 
           But usually we just let the chat cover it. 
           Maybe make it small on scroll? For now standard is fine. */
        bottom: 1.5rem;
        right: 1.5rem;
    }
}